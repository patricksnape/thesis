%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{3D Morphable Models}\label{sec:bg_3dmm}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The term 3D Morphable Models (3DMMs) was first proposed by
\citet{volker1999morphable} to describe a 3D reconstruction based on inverse
rendering methods. These methods are described as ``analysis-by-synthesis''
methods in that they attempt to model the input image by synthesising a new
image using the model and a rendering pipeline. Most commonly, this synthesised
image is then compared with the input image and the image reconstruction error
is minimised. In~\cite{volker1999morphable}, \printauthor{volker1999morphable}
model the face through two statistical models which are built using
Principal Component Analysis (PCA). The first is a generative model of 3D
facial shape and the second is a generative model of facial texture.
An instance of the models can be generated as follows
%%%%%%%%%%%%%%%%%%%
\begin{equation}\label{eg:bg_3dmm_pca}
	\bb{s} = \bb{\bar{s}} + \bb{S} \bb{\alpha} \qquad \qquad \bb{t} = \bb{\bar{t}} + \bb{T} \bb{\beta},
\end{equation}
%%%%%%%%%%%%%%%%%%%
where
$\bb{s} = {[x_1, y_1, z_1, \ldots, x_m, y_m, z_m]}^T \in \R^{3m \times 1}$ is
a vectorised instance of the $m$ vertex 3D shape model,
$\bb{\bar{s}} \in \R^{3m \times 1}$ is a mean 3D face shape,
$\bb{S} \in \R^{3m \times p}$ are the orthogonal PCA shape eigenvectors and
$\bb{\alpha} \in \R^{p \times 1}$ are the coefficients describing the unique
linear combination of eigenvectors. Similarly,
$\bb{t} = {[t_1, \ldots, t_d]}^T \in \R^{d \times 1}$ is
a vectorised instance of the $d = w \times h$ pixel texture image,
$\bb{\bar{t}} \in \R^{d \times 1}$ is a mean texture,
$\bb{T} \in \R^{d \times q}$ are the PCA texture eigenvectors and
$\bb{\beta} \in \R^{q \times 1}$ are the coefficients.
These two statistical models are built from textured meshes captured using
one of the methods outlined in \cref{sec:bg_db_capture}. For example,
the Surrey~\cite{Huber:F5Dca9zy}, Basel~\cite{paysan20093d} and
USF~\cite{volker1999morphable} models are all examples of appropriate
statistical models for 3DMM fitting.
In this thesis, we make the distinction between
``morphable models'' as statistical models and ``morphable models'' as an
analysis-by-synthesis method for 3D face recovery. When referring to
the statistical models we will simply refer to them as statistical models and
we reserve the phrase ``morphable models'' or 3DMMs solely for the
analysis-by-synthesis algorithms. In order to recover 3D shape from an image,
the objective minimised is the error between the synthesised image of the
3DMM and the input image. Thus, 3DMMs must explicitly model the rendering
method and require both synthetic camera parameters and a parametric model
of lighting. In~\cite{volker1999morphable},
the Phong illumination~\cite{tuong1973illumination} model is used to render
the illumination of the 3DMM output. These extra parameters are encapsulated
by $\bb{\rho}$ and include the parameters of a weak perspective projection
and the parameters of the Phong illumination model.
\citet{volker1999morphable} proposed to recover the 3D shape by expressing
the likelihood of observing the input image $\bb{I}$ as
$p(\bb{I} \given \bb{\alpha},\bb{\beta},\bb{\rho}) \sim \exp{[\frac{-1}{2{\sigma_N}^2} \cdot E_I]}$
assuming Gaussian noise with standard deviation $\sigma_N$ and the image
reconstruction error $E_I = \lVert \bb{I} - f(\bb{S}, \bb{\bar{s}}, \bb{\alpha}, \bb{T}, \bb{\bar{t}}, \bb{\beta}, \bb{\rho}) \rVert^2$ where $f$ is the parametrised rendering function. This
can be optimised using the maximum a posterior estimator (MAP) to form
the objective function:
%%%%%%%%%%%%%%%%%%%
\begin{equation}\label{eg:bg_3dmm_objective}
	E = \frac{1}{{\sigma_N}^2} E_I + \sum_i \frac{{\phi_i}^2}{{\sigma_{S,i}}^2} + \sum_i \frac{{\theta_i}^2}{{\sigma_{T,i}}^2} + \sum_i \frac{{\rho_i}^2 - {\rho_0}_i^2}{{\sigma_{R,i}}^2}
\end{equation}
%%%%%%%%%%%%%%%%%%%
where $\{\sigma_N,\sigma_S,\sigma_T,\sigma_R\}$ are regularisation weights,
$\{\phi_i, \theta_i \}$ are the eigenvalues of the shape and texture models
respectively and ${\rho_0}_i$ are the initial camera and illumination parameters.
This is then optimised using a stochastic gradient descent method where
only a subset of the triangles within the shape model are optimised at any
iteration. \cref{eg:bg_3dmm_objective} clearly illustrates the primary
disadvantage of 3DMM algorithms: they are complicated to optimise and contain
many local minima due to the large number of parameters. 3DMMs also require
a very accurate initialisation in terms of head pose and are unable to model
even moderate illumination variation due to the complexities of optimising
\cref{eg:bg_3dmm_objective}. Finally, 3DMMs only generalise as well as the
statistical models used within them. These models can be expensive to
construct and often do not generalise well across the entire population as
they do not contain children or individuals of non-Caucasian descent.

However, 3DMMs remain one of the most impressive 3D facial reconstruction
methods as they are highly constrained by the statistical models
of shape and texture. This causes them to be unlikely to generate results
that vary too far from the mean face and thus the textured output of a 3DMM
often looks visually convincing. Thus 3DMMs have been a popular area of
research despite their shortcomings.
\cite{atick1996statistical} proposed one of the earliest analysis-by-synthesis
methods for facial shape recovery. They compute PCA on a set of
Cyberware~\cite{cyberware} scanned heads that are parameterised using
cylindrical coordinates. They then pose shape recovery as the problem
of recovering the PCA coefficients for a given input image by minimising
the least squares error between the basis rendered orthographically
using a Lambertian BRDF (with assumed known light and uniform albedo)
and the input image. This work was inspired by the Eigenfaces work of
\citet{Sirovich:1987te} but utilised 3D data rather than images. To solve
the least squares problem a linearisation is performed via a Taylor series
expansion and conjugate gradient descent is applied.

More recently, the complex non-linear methodology of solving the 3DMM fitting
problem has been replaced by Markov Chain Monte Carlo (MCMC) sampling
methods~\cite{schonborn2016markov,egger2016occlusion,schonborn2015background}.
In this case, the analysis-by-synthesis problem is modeled probabilistically
by drawing samples from the posterior distribution of model parameters given
the target image. Given that the statistical models of both texture and shape
in the 3DMM fitting are generally modeled as PCA bases this Bayesian
perspective of fitting is very natural. This is done by naturally interpreting
the PCA bases in terms of Probabilistic PCA~\cite{tipping1999probabilistic}
In order to perform image reconstruction,
pixel comparison of the rendered image and the target is performed under a pixel-wise
conditional independence assumption, which is approximately equal to the
more classical sum of squared differences between the generated and target
image pixels. Interestingly, ~\citet{schonborn2015background} also propose
to explicitly impose a background model to prevent foreground shrinking
which was shown to significantly improve fitting performance. The pixel-wise
comparison previously described may also be relaxed to include a label
that attempts to distinguish between non-face and face pixels in the rendered
region~\cite{egger2016occlusion}. By introducing a binary labeling problem
into the MCMC framework it becomes possible to more accurately
perform 3DMM fitting in the presence of occlusions. Interestingly, recent
advances in probabilistic programming languages have also shown that MCMC solutions
to inverse rendering problems are highly attractive~\cite{kulkarni2015picture}.

Morphable Models may also be coupled with other cues, such a shading,
in order to improve the performance of the recovered shape.
\citet{patel2012driving} proposed the first method to couple 3DMMs with shading
cues in order to improve the model fitting performance.
In particular, \citet{patel2012driving} perform an iterative fitting of a
single input image by minimising the distance between the normal predicted
by the 3DMM staistical model and those of the SfS objective function
estimated from the image. In other words, these 3DMM normals are constrained
to lie closer to the space of normals described by the image given a known
lighting condition. This also allows the relaxation of the unit albedo assumption
and a spatially varying albedo is recovered.
%TODO: Check Smith's work and see if there is more stuff
%      for this section. Likely quite a lot of citations
%      are missing here.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
