%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Image Sequences: Face Flow}\label{ch:face_flow}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\minitoc{}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
In the previous chapter, we considered the problem of jointly recovering a
dense representation of shape from an unconstrained image collection. The key
insight was to leverage the shared information about the shape of an object
that is present across many different instances of the object class. This
involved employing shading cues in order to recover a joint representation
of the object class' shape in the form of a spherical harmonic basis. This
basis was estimated by performing a decomposition of the
\textit{aligned images}. This alignment was performed coarsely by assuming the
existence of a set of sparse landmarks that were used to approximate
dense correspondence between all of the images. These sparse landmarks can
be recovered very accurately across a large variety of ``in-the-wild'' facial
images and thus present an attractive method of performing alignment. However,
to perform the decomposition and recover a dense representation of shape, it
is necessary to recover dense correspondences between all of the input images. 
This was achieved by employing a piecewise constant warping function. Unfortunately, a
piecewise warping function only recovers coarse correspondences and may produce
artefacts in the case of extreme expression or head pose. Therefore, it is
desirable to be able to recover a more accurate set of dense correspondences 
between the input images. \citet{KemelmacherShlizerman:2013iv} proposed to
perform this alignment via optical flow~\cite{liu2009beyond} which provides
per-pixel dense correspondence. However, optical flow makes a
strong core assumption, namely the ``brightness constancy'' assumption, which states
that the intensity of a given pixel in the image should not change abruptly
between two differing views of the object. This assumption is clearly
violated between images of different individuals which are guaranteed to
have been captured under different illumination conditions. To aid in this,
\citet{KemelmacherShlizerman:2013iv} employed
Collection Flow~\cite{kemelmacher2012collection} which seeks to normalise
lighting effects between images of differing people. However, 
Collection Flow~\cite{kemelmacher2012collection} is unlikely to work in
scenarios containing occlusions and more severe lighting conditions.
Furthermore, the application of multiple optical flowm stages ensures that Collection
Flow is very costly to compute. In fact, optical flow is most commonly performed
on \textit{image sequences}, where the brightness constancy assumption is
much less likely to be violated. In this chapter, we seek to improve the dense
correspondences recovered between facial images in order to recover a more
accurate 3D surface. Given the difficulty in recovering an accurate pixel-wise
correspondence for ``in-the-wild'' image collections, we concentrate on
\textit{image sequences}. Image sequences of faces, or videos, are equally
as prolific as still images and thus present a readily available source of
input data. Furthermore, facial image sequences are likely to be constantly
illuminated as many sources of video are recorded under controlled lighting
conditions. This is ideal for optical flow methods as the brightness constancy
assumption is maintained. However, unlike in the previous chapter, shading cues
no longer provide a method of recovering dense 3D surfaces. This is due
to the lack of lighting variation which is required for shading based
recovery methods. However, even given these 2D correspondences it is not
straightforward to recover a 3D representation for every frame. One possible
method is Non-Rigid Structure-from-Motion (NR-SfM) which seeks to jointly
recover the 3D rigid motion and a non-rigid deformation basis for the given
correspondences. Unfortunately, these methods do not scale well to the large number
of correspondences being considered here. Only the work of \citet{garg2013dense}
provides a method of computing NR-SfM on a large number of data points. Their 
results are impressive and their use of a highly parralelizable primal
dual algorithm yields an efficient NR-SfM algorithm. However, NR-SfM is still
a costly procedure and does not take advantage of the prior knowledge provided
by the fact that the sequence contains a face. This knowledge can be leveraged
by incoporating one of the many 3D facial models that are available\footnote{As
discussed in \cref{sec:bg_db_capture}.}. Model based 3D recovery methods
are capable of recovering highly plausible 3D facial surfaces due to being
restricted to the output of a detailed 3D facial model. However, employing a 3D model
reintroduces the problem of correspondences between the image and the 3D model.
Traditionally, this has been solved by assuming a set of \textit{sparse}
correspondences between the image and manually annotated points on the model.
Given these correspondences the problem of recovering 3D facial shape becomes
one of simultaneously adjusting the non-rigid parameters of the model to fit
the face and estimating the projection parameters of the 3D points onto the given
2D points~\cite{aldrian2010linear,aldrian2013inverse,bas2016fitting}.
However, these sparse correspondences lack
detail in many areas of the face and thus are not necessarily a reliable method
of recovering accurate facial shape. Furthermore, these sparse correspondences
are primarily used because the current state-of-the-art facial 
alignment methods are only capable of recovering a low number of sparse points.
This is an issue with the available data sources and the difficulty of manually
annotating dense sets of facial features. Therefore, having a set of dense
2D tracks across a sequence that are in correspondence with a 3D model is a
highly desirable output.

Therefore, in this chapter, we focus on the most difficult part of this 
problem: computing the dense 2D correspondences via a face specific
optical flow methodology. Given the constraint
that we only seek to estimate correspondences between frames of a human face,
we provide a novel method of computing dense correspondences based on a variation
of a traditional Lucas-Kanade~\cite{lucas1981iterative} optical flow method.
Our method, which relies on the construction of a 2D deformation model of
human facial shape, is shown to outperform state-of-the-art generic optical flow
methods on challenging simulated data. We also provide a model construction
procedure that yields a 2D basis that is in correspondence with a powerful
3D facial model. 3D surfaces per-frame can then be recovered through standard
model based 3D recovery methods~\cite{aldrian2010linear,aldrian2013inverse,bas2016fitting}.


The remainder of this chapter will proceed a follows: \cref{sec:face_flow_intro}
provides an overview of the optical flow problem and in particular
outlines the challenges of long sequence tracking. \cref{sec:face_flow_method}
outlines our novel face-specific optical flow algorithm, which we call
``Face Flow''. It also outlines two methods of 2D deformation basis
creation and briefly discusses model-based 3D surface recovery.
\cref{sec:face_flow_experiments} contains our experimental work
including performance on both synthetic and real sequences for long
sequence optical flow. We also provide examples of model based 3D shape recovery
on an ``in-the-wild'' sequence. Finally, in \cref{sec:face_flow_conclusion},
we provide a summary of the chapter and draw conclusions on our results.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
{
\input{face_flow/commands}

\input{face_flow/introduction}
\input{face_flow/method}
\input{face_flow/experiments}
\input{face_flow/conclusion}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\stopcontents[chapters]
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
